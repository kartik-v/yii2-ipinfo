/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015 - 2018
 * @version 1.0.1
 *
 * Krajee IP Information fetcher plugin using PHP API from freegeoip.net. The plugin is built to work with
 * `kartik-v/yii2-ipinfo` extension. The plugin refreshes IP information via AJAX on document load.
 *
 * @see http://api.freegeoip.net
 *
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(t){"use strict";var e=function(e,n){this.$element=t(e),this.init(n)},n={exist:function(t,e){var a=n.getStore();return!!a[t]&&(new Date).getTime()-a[t].timestamp<e},get:function(t){var e=n.getStore();return e[t]?e[t].data:{}},set:function(e,a,r){var o=n.getStore();o[e]=a,delete o[e],n.setStore({timestamp:(new Date).getTime(),data:a}),t.isFunction(r)&&r(a)},getStore:function(){var t=localStorage.getItem("KvIpInfoCache");return t?JSON.parse(t):{}},setStore:function(t){localStorage.setItem("KvIpInfoCache",JSON.stringify(t))}};e.prototype={constructor:e,init:function(e){var a=this,r=a.$element,o=function(e){var n,o,i,s=e,f="",c=s.country_code;r.trigger("success.kvipinfo",[e]),s&&c?(a.flagWrapper&&(o=t.isEmptyObject(a.flagOptions)?{}:a.flagOptions,i="flag-icon-"+c.toLowerCase(),n=t(document.createElement("span")).attr(o).removeClass(i).addClass(i),t("#"+a.flagWrapper).html("").append(n)),t.each(a.fields,function(t,e){void 0!==s[e]&&(f+="<tr><th>"+a.defaultFields[e]+"</th><td>"+s[e]+"</td></tr>\n",a.setContent("p",e,s[e]),a.setContent("i",e,s[e]))}),f&&(a.setContent("p","table",f),a.setContent("i","table",f)),r.html(r.find(".kv-hide").html()),r.text().length||r.html(a.noData)):r.html(a.noData)};t.each(e,function(t,e){a[t]=e}),t.ajax({url:a.url,type:"GET",dataType:"json",data:a.params,beforeSend:function(t){return r.trigger("beforesend.kvipinfo",[t]),!a.cache||!n.exist(a.url,a.cacheTimeout)||(o(n.get(a.url)),!1)},success:function(t,e,r){a.cache?n.set(a.url,t,o):o(t)},error:function(t,e,n){r.trigger("error.kvipinfo",[t,e,n]).html(a.errorData)}})},setContent:function(e,n,a){var r=this.$element.attr("id"),o=t(("table"===n?"table.":"#")+r+"-"+n+"-"+e);o.length&&(a.length?o.html(a):o.remove())}},t.fn.kvIpInfo=function(n){var a=Array.apply(null,arguments);return a.shift(),this.each(function(){var r,o=t(this),i=o.data("kvIpInfo"),s="object"==typeof n&&n;i||(r=t.extend({},t.fn.kvIpInfo.defaults),i=new e(this,t.extend(r,s,o.data())),o.data("kvIpInfo",i)),"string"==typeof n&&i[n].apply(i,a)})},t.fn.kvIpInfo.defaults={flagWrapper:"",flagOptions:{},fields:[],defaultFields:{},url:"",params:{},noData:"",errorData:"",cache:!0,cacheTimeout:0},t.fn.kvIpInfo.cache={},t.fn.kvIpInfo.Constructor=e}(window.jQuery);